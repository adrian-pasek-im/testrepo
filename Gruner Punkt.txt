SELECT  UPPER(ic."Code2") as "Country"
		, sum(V_D1."Quantity") as "Items"
        , count( distinct V_D."OrderReference") as "Orders",
	'Returns' AS "Type"
FROM     REPORT.V_DATARETURNS_RETURN V_D
         LEFT OUTER JOIN REPORT.V_DATARETURNS_RETURNLINE V_D1 ON V_D."Id"=V_D1."ReturnId"
         LEFT OUTER JOIN REPORT.V_DATARETURNS_RETURNSHIPMENT V_D2 ON V_D."ReturnShipmentId"=V_D2."Id" 
		 LEFT OUTER JOIN REPORT.V_ISOSTANDARDS_COUNTRY IC on V_D2."CustomerCountryId" = IC."Id"
WHERE    V_D."CompanyId" = 3 
AND      TRUNC(V_D."DateTimeDone") BETWEEN '2020-10-01' AND '2020-10-31'
and ic."Code2" in ('de', 'at', 'nl', 'es')
group by ic."Code2"




WITH QTY_SHIPPED AS
(SELECT  DEL.ORDERNR AS ORDERNR, ORD.LANDKODE AS LANDKODE, SUM(DEL.QTY_SHIPPED) AS QTY_SHIPPED 
FROM     GOFSLIVE_GOFOS2.DELIVERY_CHECK DEL
JOIN     GOFSLIVE_GOFOS2.ORDERHDR_EXT ORD ON DEL.ORDERNR=ORD.ORDERNR AND DEL.BEDRYFNR=ORD.BEDRYFNR
WHERE    DEL.BEDRYFNR = 920
AND 	 ORD.LANDKODE IN ('AT','DE', 'NL', 'ES')
GROUP BY DEL.ORDERNR, ORD.LANDKODE),

ORDER_QTY AS
(SELECT  DISTINCT SHI.ORDERNR AS ORDERNR, ORD.LANDKODE AS LANDKODE, 
         TO_DATE(CON1.DATE_FROM,'YYYY-MM-DD')  AS DISPATCH
FROM     GOFSLIVE_GOFOS2.SHIP_MANIFEST_2HST SHI
		 JOIN GOFSLIVE_GOFOS2.ORDERHDR_EXT ORD ON SHI.ORDERNR=ORD.ORDERNR AND SHI.BEDRYFNR=ORD.BEDRYFNR
         JOIN GOFSLIVE_GOFOS2.CONTAINER_LINE_HST CON ON SHI.BEDRYFNR=CON.BEDRYFNR AND SHI.REF_EANKODE=CON.CRISPLANTEAN
         JOIN GOFSLIVE_GOFOS2.CONTAINER_LOG CON1 ON CON.DATUM=CON1.DATUM AND CON.SORTING_CODE=CON1.SORTING_CODE AND CON.VOLGNR=CON1.VOLGNR
WHERE    SHI.BEDRYFNR = 920 
AND      CON1.MELDING = 'Closing truck; Containers in truck' 
AND      TO_DATE(CON1.DATE_FROM,'YYYY-MM-DD') BETWEEN TO_DATE('2020-11-01', 'YYYY-MM-DD') AND TO_DATE('2020-11-30', 'YYYY-MM-DD')
AND	  ORD.LANDKODE IN ('AT', 'DE', 'NL', 'ES'))

SELECT ORD.LANDKODE AS "Country",
	SUM(QTY.QTY_SHIPPED) AS "Items",
	   COUNT(ORD.ORDERNR) AS "Orders",
	   'Outbound' AS "Type"
FROM   ORDER_QTY ORD
	   JOIN QTY_SHIPPED QTY ON ORD.ORDERNR=QTY.ORDERNR
GROUP BY ORD.LANDKODE